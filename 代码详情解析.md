# Conditional Tokens ä¸­æ–‡æ–‡æ¡£å¯¼èˆª ðŸ§­

> æ¬¢è¿Žï¼è¿™é‡Œæ˜¯ Conditional Tokens é¡¹ç›®çš„ä¸­æ–‡å­¦ä¹ èµ„æºå¯¼èˆª

---

## ðŸ“š æ–‡æ¡£åˆ—è¡¨

æˆ‘ä¸ºä½ å‡†å¤‡äº†ä¸‰ä»½ä¸­æ–‡æ–‡æ¡£ï¼Œä»Žä¸åŒè§’åº¦å¸®åŠ©ä½ ç†è§£è¿™ä¸ªé¡¹ç›®ï¼š

### 1ï¸âƒ£ [æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£.md](./æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£.md) ðŸ“–

**å®Œæ•´è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£**

- âœ… é€‚åˆï¼šæƒ³è¦æ·±å…¥ç†è§£é¡¹ç›®çš„å¼€å‘è€…
- ðŸ“„ å†…å®¹ï¼š
  - é¡¹ç›®æ¦‚è¿°å’Œæ ¸å¿ƒæ¦‚å¿µ
  - æŠ€æœ¯æž¶æž„è¯¦è§£
  - æ ¸å¿ƒåˆçº¦å‡½æ•°è¯´æ˜Ž
  - å®Œæ•´ä½¿ç”¨æµç¨‹
  - ä»£ç ç¤ºä¾‹
  - å¼€å‘çŽ¯å¢ƒæ­å»º
  - é«˜çº§ä¸»é¢˜ï¼ˆä½è¿ç®—ã€ERC1155é›†æˆç­‰ï¼‰
  - FAQ å¸¸è§é—®é¢˜
  - å®‰å…¨è€ƒè™‘
  - å®žé™…åº”ç”¨æ¡ˆä¾‹

**æŽ¨èé˜…è¯»é¡ºåº**ï¼šä»Žå¤´åˆ°å°¾å®Œæ•´é˜…è¯»ï¼Œå»ºè®®é…åˆä»£ç ä¸€èµ·çœ‹

---

### 2ï¸âƒ£ [å¿«é€Ÿå…¥é—¨æŒ‡å—.md](./å¿«é€Ÿå…¥é—¨æŒ‡å—.md) âš¡

**5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹**

- âœ… é€‚åˆï¼šæƒ³è¦å¿«é€Ÿäº†è§£å’Œä½¿ç”¨çš„å¼€å‘è€…
- ðŸ“„ å†…å®¹ï¼š
  - ä¸€å¥è¯æ€»ç»“
  - æ ¸å¿ƒæ¦‚å¿µé€Ÿè®°
  - 5æ­¥åˆ›å»ºé¢„æµ‹å¸‚åœº
  - å®žç”¨ç¤ºä¾‹
  - å¸¸ç”¨å·¥å…·å‡½æ•°
  - ä½æŽ©ç é€ŸæŸ¥è¡¨
  - æœ¬åœ°æµ‹è¯•æ­¥éª¤
  - å¸¸è§é”™è¯¯è§£å†³

**æŽ¨èé˜…è¯»é¡ºåº**ï¼šå…ˆçœ‹è¿™ä¸ªï¼Œå¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥

---

### 3ï¸âƒ£ [æž¶æž„å›¾è§£.md](./æž¶æž„å›¾è§£.md) ðŸ“

**å¯è§†åŒ–æž¶æž„å’Œæµç¨‹**

- âœ… é€‚åˆï¼šè§†è§‰å­¦ä¹ è€…ï¼Œå–œæ¬¢çœ‹å›¾çš„å¼€å‘è€…
- ðŸ“„ å†…å®¹ï¼š
  - ç³»ç»Ÿæž¶æž„æ€»è§ˆå›¾
  - å®Œæ•´ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾
  - æ¡ä»¶å’Œä½ç½®å…³ç³»å›¾
  - åˆ†å‰²/åˆå¹¶æœºåˆ¶å›¾è§£
  - æ”¯ä»˜è®¡ç®—ç¤ºä¾‹
  - åµŒå¥—æ¡ä»¶æ ‘çŠ¶å›¾
  - ID è®¡ç®—æµç¨‹
  - çŠ¶æ€æœºå›¾
  - ä½è¿ç®—æŠ€å·§
  - å®žé™…åº”ç”¨æž¶æž„

**æŽ¨èé˜…è¯»é¡ºåº**ï¼šé…åˆå…¶ä»–æ–‡æ¡£ï¼Œé‡åˆ°ä¸ç†è§£çš„æ¦‚å¿µæ—¶æŸ¥çœ‹å¯¹åº”å›¾è§£

---

## ðŸŽ¯ å­¦ä¹ è·¯å¾„æŽ¨è

### è·¯å¾„ Aï¼šå¿«é€Ÿå…¥é—¨åž‹ï¼ˆ1å°æ—¶ï¼‰

```
1. å¿«é€Ÿå…¥é—¨æŒ‡å—.md (15åˆ†é’Ÿ)
   â†“
2. è¿è¡Œæœ¬åœ°æµ‹è¯• (20åˆ†é’Ÿ)
   â†“
3. æŸ¥çœ‹æµ‹è¯•ä»£ç  test/test-conditional-tokens.js (25åˆ†é’Ÿ)
```

### è·¯å¾„ Bï¼šæ·±åº¦å­¦ä¹ åž‹ï¼ˆ4-6å°æ—¶ï¼‰

```
1. å¿«é€Ÿå…¥é—¨æŒ‡å—.md (15åˆ†é’Ÿ)
   â†“
2. æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£.md (1.5å°æ—¶)
   â†“
3. æž¶æž„å›¾è§£.md (30åˆ†é’Ÿ)
   â†“
4. é˜…è¯»æ ¸å¿ƒåˆçº¦ä»£ç  (1å°æ—¶)
   contracts/ConditionalTokens.sol
   contracts/CTHelpers.sol
   â†“
5. è¿è¡Œå’Œåˆ†æžæµ‹è¯• (1å°æ—¶)
   test/test-conditional-tokens.js
   â†“
6. åŠ¨æ‰‹å®žè·µï¼šåˆ›å»ºè‡ªå·±çš„æ¡ä»¶ (1å°æ—¶)
```

### è·¯å¾„ Cï¼šè§†è§‰å­¦ä¹ åž‹ï¼ˆ2å°æ—¶ï¼‰

```
1. æž¶æž„å›¾è§£.md (30åˆ†é’Ÿ)
   â†“
2. å¿«é€Ÿå…¥é—¨æŒ‡å—.md (15åˆ†é’Ÿ)
   â†“
3. æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£.md - åªçœ‹ç¤ºä¾‹éƒ¨åˆ† (30åˆ†é’Ÿ)
   â†“
4. è¿è¡Œæµ‹è¯•å¹¶å¯¹ç…§å›¾è§£ç†è§£ (45åˆ†é’Ÿ)
```

---

## ðŸ” å¿«é€ŸæŸ¥æ‰¾

### æˆ‘æƒ³äº†è§£...

| é—®é¢˜ | æŸ¥çœ‹æ–‡æ¡£ | ç« èŠ‚ |
|------|---------|------|
| ä»€ä¹ˆæ˜¯ Conditional Tokensï¼Ÿ | å¿«é€Ÿå…¥é—¨æŒ‡å— | ä¸€å¥è¯æ€»ç»“ |
| æ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ | æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£ | æ ¸å¿ƒæ¦‚å¿µ |
| å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¡ä»¶ï¼Ÿ | å¿«é€Ÿå…¥é—¨æŒ‡å— | 5æ­¥åˆ›å»ºé¢„æµ‹å¸‚åœº |
| åˆ†å‰²å’Œåˆå¹¶æ€Žä¹ˆå·¥ä½œï¼Ÿ | æž¶æž„å›¾è§£ | åˆ†å‰²å’Œåˆå¹¶æœºåˆ¶ |
| ä½æŽ©ç æ€Žä¹ˆç”¨ï¼Ÿ | å¿«é€Ÿå…¥é—¨æŒ‡å— | ä½æŽ©ç é€ŸæŸ¥è¡¨ |
| å¦‚ä½•è®¡ç®—æ”¯ä»˜ï¼Ÿ | æž¶æž„å›¾è§£ | æ”¯ä»˜è®¡ç®—ç¤ºä¾‹ |
| åµŒå¥—æ¡ä»¶æ€Žä¹ˆåšï¼Ÿ | æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£ | ä»£ç ç¤ºä¾‹ - ç¤ºä¾‹2 |
| åˆçº¦å‡½æ•°è¯¦è§£ | æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£ | æ ¸å¿ƒåˆçº¦è¯¦è§£ |
| å¦‚ä½•æ­å»ºå¼€å‘çŽ¯å¢ƒï¼Ÿ | æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£ | å¼€å‘çŽ¯å¢ƒæ­å»º |
| å¸¸è§é”™è¯¯æ€Žä¹ˆè§£å†³ï¼Ÿ | å¿«é€Ÿå…¥é—¨æŒ‡å— | é‡åˆ°é—®é¢˜ï¼Ÿ |
| ç³»ç»Ÿæž¶æž„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ | æž¶æž„å›¾è§£ | ç³»ç»Ÿæž¶æž„æ€»è§ˆ |
| å®‰å…¨æ³¨æ„äº‹é¡¹ | æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£ | å®‰å…¨è€ƒè™‘ |

---

## ðŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æž„

```
conditional-tokens-contracts/
â”‚
â”œâ”€â”€ ðŸ“„ ä¸­æ–‡æ–‡æ¡£ (æ–°å¢ž)
â”‚   â”œâ”€â”€ ä¸­æ–‡æ–‡æ¡£å¯¼èˆª.md          â† ä½ åœ¨è¿™é‡Œ
â”‚   â”œâ”€â”€ æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£.md   â† å®Œæ•´æŠ€æœ¯æ–‡æ¡£
â”‚   â”œâ”€â”€ å¿«é€Ÿå…¥é—¨æŒ‡å—.md          â† å¿«é€Ÿä¸Šæ‰‹
â”‚   â””â”€â”€ æž¶æž„å›¾è§£.md              â† å¯è§†åŒ–å›¾è§£
â”‚
â”œâ”€â”€ ðŸ“ contracts/               â† æ™ºèƒ½åˆçº¦æºç 
â”‚   â”œâ”€â”€ ConditionalTokens.sol   â† æ ¸å¿ƒåˆçº¦
â”‚   â”œâ”€â”€ CTHelpers.sol           â† è¾…åŠ©å‡½æ•°åº“
â”‚   â””â”€â”€ ERC1155/                â† ERC1155 å®žçŽ°
â”‚
â”œâ”€â”€ ðŸ“ test/                    â† æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ test-conditional-tokens.js
â”‚
â”œâ”€â”€ ðŸ“ docs/                    â† è‹±æ–‡å®˜æ–¹æ–‡æ¡£
â”‚   â”œâ”€â”€ index.rst
â”‚   â”œâ”€â”€ developer-guide.rst
â”‚   â””â”€â”€ glossary.rst
â”‚
â”œâ”€â”€ ðŸ“ utils/                   â† å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ id-helpers.js
â”‚
â””â”€â”€ ðŸ“„ README.rst               â† è‹±æ–‡ README
```

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Ÿè·Ÿç€è¿™ä¸ªèµ°ï¼š

#### 1. é˜…è¯»å¿«é€Ÿå…¥é—¨ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# æ‰“å¼€å¿«é€Ÿå…¥é—¨æŒ‡å—
cat å¿«é€Ÿå…¥é—¨æŒ‡å—.md
```

#### 2. å®‰è£…å’Œæµ‹è¯•ï¼ˆ10åˆ†é’Ÿï¼‰

```bash
# å®‰è£…ä¾èµ–
npm install

# ç¼–è¯‘åˆçº¦
npm run compile

# è¿è¡Œæµ‹è¯•
npm test
```

#### 3. æŸ¥çœ‹æµ‹è¯•ä»£ç ï¼ˆ15åˆ†é’Ÿï¼‰

```bash
# æ‰“å¼€æµ‹è¯•æ–‡ä»¶
cat test/test-conditional-tokens.js
```

#### 4. æ·±å…¥å­¦ä¹ ï¼ˆæŒ‰éœ€ï¼‰

æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©å¯¹åº”çš„æ–‡æ¡£æ·±å…¥é˜…è¯»ã€‚

---

## ðŸ’¡ å­¦ä¹ å»ºè®®

### âœ… æŽ¨èåšæ³•

1. **å…ˆå¿«åŽæ…¢**ï¼šå…ˆçœ‹å¿«é€Ÿå…¥é—¨ï¼Œå»ºç«‹æ•´ä½“è®¤çŸ¥ï¼Œå†æ·±å…¥ç»†èŠ‚
2. **è¾¹çœ‹è¾¹åš**ï¼šé˜…è¯»æ–‡æ¡£çš„åŒæ—¶è¿è¡Œæµ‹è¯•ï¼Œå®žé™…æ“ä½œ
3. **ç”»å›¾ç†è§£**ï¼šè‡ªå·±ç”»å›¾æ¢³ç†æ¦‚å¿µå…³ç³»
4. **æé—®è®°å½•**ï¼šé‡åˆ°ä¸æ‡‚çš„è®°ä¸‹æ¥ï¼ŒåŽç»­æŸ¥æ‰¾ç­”æ¡ˆ
5. **ä»£ç å¯¹ç…§**ï¼šæ–‡æ¡£å’Œä»£ç å¯¹ç…§ç€çœ‹

### âŒ é¿å…åšæ³•

1. âŒ ä¸€ä¸Šæ¥å°±çœ‹åˆçº¦ä»£ç 
2. âŒ è·³è¿‡åŸºç¡€æ¦‚å¿µç›´æŽ¥çœ‹é«˜çº§ä¸»é¢˜
3. âŒ åªçœ‹ä¸åšï¼Œä¸è¿è¡Œæµ‹è¯•
4. âŒ é‡åˆ°é—®é¢˜å°±æ”¾å¼ƒï¼Œä¸æŸ¥æ–‡æ¡£

---

## ðŸŽ“ æ ¸å¿ƒæ¦‚å¿µé€Ÿè®°å¡

### æ¡ä»¶ (Condition)
```
ä¸€ä¸ªéœ€è¦å›žç­”çš„é—®é¢˜
= é¢„è¨€æœº + é—®é¢˜ID + ç»“æžœæ•°é‡
```

### ä½ç½® (Position)
```
ä½ åœ¨æŸä¸ªç»“æžœä¸Šçš„æƒç›Š
= æŠµæŠ¼ä»£å¸ + ç»“æžœç»„åˆ
= ERC1155 ä»£å¸
```

### åˆ†å‰² (Split)
```
æŠµæŠ¼å“ â†’ å¤šä¸ªä½ç½®ä»£å¸
é”å®šèµ„äº§ï¼Œé“¸é€ ä»£å¸
```

### åˆå¹¶ (Merge)
```
å¤šä¸ªä½ç½®ä»£å¸ â†’ æŠµæŠ¼å“
é”€æ¯ä»£å¸ï¼Œé‡Šæ”¾èµ„äº§
```

### èµŽå›ž (Redeem)
```
æ­£ç¡®çš„ä½ç½®ä»£å¸ â†’ æŠµæŠ¼å“
æ ¹æ®æ”¯ä»˜å‘é‡è®¡ç®—
```

---

## ðŸ”— ç›¸å…³èµ„æº

### å®˜æ–¹èµ„æº

- **GitHub**: https://github.com/gnosis/conditional-tokens-contracts
- **Gnosis å®˜ç½‘**: https://gnosis.io/
- **å®˜æ–¹æ–‡æ¡£**: https://docs.gnosis.io/conditionaltokens/

### ç›¸å…³æ ‡å‡†

- **ERC1155**: https://eips.ethereum.org/EIPS/eip-1155
- **ERC20**: https://eips.ethereum.org/EIPS/eip-20

### ç›¸å…³é¡¹ç›®

- **Omen é¢„æµ‹å¸‚åœº**: https://omen.eth.link/
- **Reality.eth é¢„è¨€æœº**: https://reality.eth.link/
- **Gnosis Safe**: https://gnosis-safe.io/

---

## ðŸ“ž èŽ·å–å¸®åŠ©

### é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹ FAQ**ï¼šæ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£.md â†’ å¸¸è§é—®é¢˜
2. **æŸ¥çœ‹å¸¸è§é”™è¯¯**ï¼šå¿«é€Ÿå…¥é—¨æŒ‡å—.md â†’ é‡åˆ°é—®é¢˜ï¼Ÿ
3. **æŸ¥çœ‹æµ‹è¯•ç”¨ä¾‹**ï¼štest/test-conditional-tokens.js
4. **æäº¤ Issue**ï¼šhttps://github.com/gnosis/conditional-tokens-contracts/issues

### æƒ³è¦è´¡çŒ®ï¼Ÿ

æ¬¢è¿Žæ”¹è¿›è¿™äº›ä¸­æ–‡æ–‡æ¡£ï¼å¦‚æžœä½ å‘çŽ°ï¼š
- é”™åˆ«å­—æˆ–ç¿»è¯‘ä¸å‡†ç¡®
- æ¦‚å¿µè§£é‡Šä¸æ¸…æ¥š
- ç¼ºå°‘é‡è¦ä¿¡æ¯
- æœ‰æ›´å¥½çš„ç¤ºä¾‹

è¯·éšæ—¶æå‡ºå»ºè®®æˆ–æäº¤ PRï¼

---

## ðŸ“Š æ–‡æ¡£ç»Ÿè®¡

| æ–‡æ¡£ | å­—æ•° | é˜…è¯»æ—¶é—´ | éš¾åº¦ |
|------|------|---------|------|
| å¿«é€Ÿå…¥é—¨æŒ‡å— | ~3000å­— | 15åˆ†é’Ÿ | â­â­ |
| æ¡ä»¶ä»£å¸åˆçº¦ä¸­æ–‡æ–‡æ¡£ | ~12000å­— | 1.5å°æ—¶ | â­â­â­â­ |
| æž¶æž„å›¾è§£ | ~5000å­— | 30åˆ†é’Ÿ | â­â­â­ |

---

## ðŸŽ‰ å¼€å§‹å­¦ä¹ å§ï¼

é€‰æ‹©ä¸€ä¸ªé€‚åˆä½ çš„å­¦ä¹ è·¯å¾„ï¼Œå¼€å§‹æŽ¢ç´¢ Conditional Tokens çš„ä¸–ç•Œï¼

**ç¥å­¦ä¹ æ„‰å¿«ï¼** ðŸš€

---

**æ–‡æ¡£åˆ›å»ºæ—¥æœŸ**: 2026-01-27  
**æœ€åŽæ›´æ–°**: 2026-01-27  
**ç»´æŠ¤è€…**: AI Assistant


å¤ªå¥½äº† ðŸ‘
é‚£æˆ‘ä»¬å°±ç”¨ä¸€ä¸ªæœ€ç®€å•ã€æœ€çœŸå®žã€èƒ½é€è¡Œå¯¹ç…§ä»£ç çš„ä¾‹å­ï¼Œ
æ‰€æœ‰å˜é‡æˆ‘éƒ½ä¼šç»™å‡ºâ€œå…·ä½“æ•°å€¼â€ï¼Œä½ åªè¦è·Ÿç€çœ‹ï¼Œä¸éœ€è¦è‡ªå·±ç®—ã€‚

ðŸŽ¯ çœŸå®žä¾‹å­è®¾å®šï¼ˆå›ºå®šä¸å˜ï¼‰
é—®é¢˜ï¼ˆconditionï¼‰

æ˜Žå¤©ä¸‹é›¨å—ï¼Ÿ

outcomeSlotCount = 2

outcome 0ï¼šYES

outcome 1ï¼šNO

ðŸ‘‰ è¿™è¯´æ˜Ž prepareCondition å·²ç»è·‘è¿‡äº†ã€‚

ä½ ï¼ˆç”¨æˆ·ï¼‰æƒ³åšçš„äº‹

ç”¨ 10 USDCï¼Œç”Ÿæˆ YES å’Œ NO ç¥¨

è¿™å°±æ˜¯ Polymarket é‡Œæœ€å¸¸è§çš„æ“ä½œã€‚

ðŸ§¾ ä½ è°ƒç”¨çš„ splitPositionï¼ˆå®Œæ•´å‚æ•°ï¼‰
splitPosition(
    USDC,                 // collateralToken
    0x0,                  // parentCollectionIdï¼ˆç¬¬ä¸€æ¬¡æ‹†ï¼‰
    conditionId,           // æ˜Žå¤©ä¸‹é›¨è¿™ä¸ªé—®é¢˜
    [1, 2],               // partitionï¼šYES, NO
    10                    // amountï¼š10
)


è®°ä½ï¼š
partition = [1, 2]

1 = YES

2 = NO

ðŸ§  åˆçº¦æ‰§è¡Œæ—¶ï¼Œæ¯ä¸€è¡Œå˜é‡çš„çœŸå®žå€¼

ä¸‹é¢ ä¸¥æ ¼æŒ‰ä»£ç é¡ºåºèµ°ã€‚

ç¬¬ 1 è¡Œæ£€æŸ¥
require(partition.length > 1);


partition.length = 2

âœ… é€šè¿‡

ç¬¬ 2 æ­¥ï¼šè¯»å– outcome æ•°
uint outcomeSlotCount = payoutNumerators[conditionId].length;


prepareCondition æ—¶åˆå§‹åŒ–äº† uint

outcomeSlotCount = 2

require(outcomeSlotCount > 0);


âœ… é€šè¿‡

ç¬¬ 3 æ­¥ï¼šç®— fullIndexSet
uint fullIndexSet = (1 << outcomeSlotCount) - 1;


ä»£å…¥æ•°å€¼ï¼š

1 << 2 = 4
4 - 1 = 3


ðŸ‘‰

fullIndexSet = 3ï¼ˆäºŒè¿›åˆ¶ 0b11ï¼‰


æ„æ€ï¼šYES + NO

ç¬¬ 4 æ­¥ï¼šåˆå§‹åŒ– freeIndexSet
uint freeIndexSet = fullIndexSet;

freeIndexSet = 3ï¼ˆ0b11ï¼‰


æ„æ€ï¼šYES å’Œ NO éƒ½è¿˜æ²¡è¢«ç”¨

ç¬¬ 5 æ­¥ï¼šå‡†å¤‡æ•°ç»„
positionIds = new uint
amounts     = new uint


åˆå§‹çŠ¶æ€ï¼š

positionIds = [ ?, ? ]
amounts     = [ ?, ? ]

ðŸ” for å¾ªçŽ¯å¼€å§‹ï¼ˆæœ€å…³é”®ï¼‰
ðŸŒ€ ç¬¬ä¸€æ¬¡å¾ªçŽ¯ï¼ˆi = 0ï¼‰
uint indexSet = partition[0];

indexSet = 1ï¼ˆäºŒè¿›åˆ¶ 01ï¼‰ â†’ YES

æ£€æŸ¥ indexSet åˆæ³•æ€§
require(indexSet > 0 && indexSet < fullIndexSet);

1 > 0  âœ…
1 < 3  âœ…

æ£€æŸ¥æ˜¯å¦å’Œä¹‹å‰é‡å¤
require((indexSet & freeIndexSet) == indexSet);


ä»£å…¥ï¼š

indexSet & freeIndexSet
= 01 & 11
= 01

01 == 01 âœ…


æ„æ€ï¼šYES ä¹‹å‰æ²¡è¢«ç”¨è¿‡

æ›´æ–° freeIndexSet
freeIndexSet ^= indexSet;

freeIndexSet = 11 ^ 01 = 10ï¼ˆäºŒè¿›åˆ¶ï¼‰


ðŸ‘‰

freeIndexSet = 2 â†’ åªå‰© NO

è®¡ç®— positionId
positionIds[0] = positionId(USDC, YES)
amounts[0] = 10


çŽ°åœ¨ï¼š

positionIds = [ YESç¥¨ID, ? ]
amounts     = [ 10, ? ]

ðŸŒ€ ç¬¬äºŒæ¬¡å¾ªçŽ¯ï¼ˆi = 1ï¼‰
uint indexSet = partition[1];

indexSet = 2ï¼ˆäºŒè¿›åˆ¶ 10ï¼‰ â†’ NO

åˆæ³•æ€§æ£€æŸ¥
2 > 0 âœ…
2 < 3 âœ…

æ˜¯å¦é‡å¤ï¼Ÿ
(indexSet & freeIndexSet) == indexSet

10 & 10 = 10 âœ…


è¯´æ˜Žï¼šNO æ²¡è¢«ç”¨è¿‡

æ›´æ–° freeIndexSet
freeIndexSet ^= indexSet

10 ^ 10 = 00


ðŸ‘‰

freeIndexSet = 0

è®°å½• positionId
positionIds = [ YESç¥¨ID, NOç¥¨ID ]
amounts     = [ 10,       10     ]

ðŸ” for å¾ªçŽ¯ç»“æŸåŽçš„å…³é”®åˆ¤æ–­
if (freeIndexSet == 0)


çŽ°åœ¨ï¼š

freeIndexSet = 0


âœ… æˆç«‹

æ„æ€ï¼š

ä½ ç»™çš„ partitionï¼ˆYES + NOï¼‰
æ­£å¥½æŠŠæ‰€æœ‰ outcome éƒ½è¦†ç›–å®Œäº†

å†åˆ¤æ–­æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡æ‹†
if (parentCollectionId == 0)


ä½ ä¼ çš„æ˜¯ï¼š

parentCollectionId = 0x0


âœ… æˆç«‹

åˆçº¦æ‰§è¡Œã€ŒçœŸå®žåŠ¨ä½œã€
collateralToken.transferFrom(msg.sender, address(this), amount);


ä¹Ÿå°±æ˜¯ï¼š

USDC.transferFrom(ä½  â†’ åˆçº¦, 10)


æ­¤æ—¶ï¼š

ä½ ï¼š
- USDC = -10

åˆçº¦ï¼š
- USDC = +10

ðŸŽ‰ æœ€åŽä¸€æ­¥ï¼šå‘æ–°ç¥¨
_batchMint(
    ä½ ,
    [YESç¥¨ID, NOç¥¨ID],
    [10, 10]
)


ä½ çš„é’±åŒ…çŽ°åœ¨æ˜¯ï¼š

USDC = åŽŸæ¥ - 10
YES  = 10
NO   = 10

ðŸ§¾ æ•´ä¸ªå‡½æ•°â€œå‰åŽå¯¹ç…§è¡¨â€
é˜¶æ®µ	USDC	YES	NO
è°ƒç”¨å‰	10	0	0
splitPosition åŽ	0	10	10
ðŸ§  çŽ°åœ¨ä½ å›žå¤´çœ‹ä»£ç ï¼Œåº”è¯¥èƒ½å¯¹åº”ä¸Šäº†

partition = [1,2]
ðŸ‘‰ æˆ‘æƒ³è¦ YES å’Œ NO

freeIndexSet
ðŸ‘‰ åˆçº¦åœ¨è®°è´¦ï¼šå“ªäº›ç»“æžœè¢«ç”¨æŽ‰äº†

freeIndexSet == 0
ðŸ‘‰ ä½ æ˜¯ä¸æ˜¯æŠŠâ€œæ•´å¼ é’±â€æ‹†å®Œäº†

transferFrom
ðŸ‘‰ å› ä¸ºä½ æ˜¯ç¬¬ä¸€æ¬¡æ‹†ï¼Œåªèƒ½ç”¨çœŸé’±

_batchMint
ðŸ‘‰ æŠŠç¥¨å‘ç»™ä½ 

âœ… å¦‚æžœä½ çŽ°åœ¨èƒ½è¯´å‡ºè¿™å¥è¯ï¼Œå°±è¯´æ˜Žä½ çœŸçš„æ‡‚äº†ï¼š

splitPosition å°±æ˜¯ï¼š
æˆ‘ç»™åˆçº¦ 10 USDCï¼Œ
åˆçº¦ç»™æˆ‘ 10 å¼  YES å’Œ 10 å¼  NOï¼Œ
å¹¶ä¿è¯å®ƒä»¬å°†æ¥èƒ½ä¸€ä¸€å…‘æ¢å›žé’±ã€‚